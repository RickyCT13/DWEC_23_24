<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DWEC Tarea 1 Tema 10</title>
</head>

<body>
    <h1>Ejemplo 1 Tema 10</h1>
    <select id="select">
        <option selected disabled>Seleccione una opci√≥n</option>

    </select>

    <div id="datos">

    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            mostrarNombres();
        });

        /* Averiguar como cargar nombres en select */
        function funAjax(url, fun) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    fun(JSON.parse(this.responseText));
                }
            };
            xhttp.open("GET", url, true);
            xhttp.send();
        }

        function mostrarNombres() {
            funAjax('datos.php', function (datos) {
                let select = document.getElementById("select");

                datos.forEach(dato => {
                    let option = document.createElement("option");
                    option.value = dato.id;
                    option.text = dato.nombre;
                    select.add(option);
                });
                select.addEventListener("change", () => {
                    let id = this.value;

                    funAjax(`datos.php?id=${id}`, (registro) => {
                        mostrarDatos(registro);
                    });
                });
            });
        }

        function mostrarDatos(registro) {
            let divDatos = document.getElementById("datos");

            let tabla = `<table border="1">`;
            for (let clave in registro) {
                    let valor = registro[clave];
                    tabla += `<tr><th>${clave}</th><td>${valor}</td></tr>`;
            }
            tabla += `</table>`;
            divDatos.innerHTML = tabla;
        }
    </script>
</body>

</html>